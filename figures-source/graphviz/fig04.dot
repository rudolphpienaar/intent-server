digraph ExternalIAS {
    rankdir=TB;
    splines=ortho;
    node [shape=box, style="rounded,filled", fontname="Arial", fontsize=11];
    edge [fontname="Arial", fontsize=10];

    // User intents
    viz_intent [label="User Visualization Intent\n(\"show feeds\")", fillcolor="#E8F4F8"];
    behav_intent [label="User Behavioral Intent\n(\"anonymize\")", fillcolor="#E8F4F8"];

    // ChRIS UI cluster
    subgraph cluster_ui {
        label="ChRIS UI";
        style=filled;
        fillcolor="#B3D9E6";
        fontsize=13;
        fontname="Arial Bold";

        react [label="React Components\n(presentation only)", fillcolor="#B3D9E6"];
        js_lib [label="JS Thin Client Library", fillcolor="#B3D9E6"];

        react -> js_lib [style=invis];
    }

    // IAS cluster
    subgraph cluster_ias {
        label="Intent-Action Service (IAS)";
        style=filled;
        fillcolor="#FFE5B4";
        fontsize=13;
        fontname="Arial Bold";

        orchestrator [label="Intent Logic\nOrchestrator", fillcolor="#FFCCCC", style="rounded,filled,dashed"];
    }

    // CUBE cluster
    subgraph cluster_cube {
        label="CUBE";
        style=filled;
        fillcolor="#C8E6C9";
        fontsize=13;
        fontname="Arial Bold";

        cj_api [label="Collection+JSON API", fillcolor="#C8E6C9"];
        cube_internals [label="CUBE Python/Django Internals\n(declarative substrate preserved)", fillcolor="#C8E6C9"];

        cj_api -> cube_internals [style=invis];
    }

    // Flows - visualization bypasses IAS
    viz_intent -> react;
    react -> cj_api [label="  direct\n  visualization"];

    // Behavioral goes through IAS
    behav_intent -> react;
    react -> orchestrator [label="  behavioral\n  intent"];
    orchestrator -> cj_api [label="      multiple\n      orchestrated\n      calls", style=dashed, color="#555555"];
}
